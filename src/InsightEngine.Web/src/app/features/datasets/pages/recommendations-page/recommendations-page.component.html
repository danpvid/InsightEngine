<div class="container-wide" style="max-width:none;width:100%;">
  <nav class="breadcrumb">
    <a [routerLink]="newDatasetLink" class="breadcrumb-item">
      <mat-icon>upload_file</mat-icon>
      <span>{{ 'common.datasets' | translate }}</span>
    </a>
    <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
    <span class="breadcrumb-item active">
      <mat-icon>auto_awesome</mat-icon>
      <span>{{ 'recommendations.breadcrumb' | translate }}</span>
    </span>
  </nav>

  <div class="recommendations-actions">
    <button mat-stroked-button color="primary" [routerLink]="exploreLink">
      <mat-icon>travel_explore</mat-icon>
      {{ 'recommendations.openExplore' | translate }}
    </button>
  </div>

  <mat-card class="dataset-info-card">
    <mat-card-content>
      <div class="dataset-name-section" *ngIf="datasetName">
        <div class="dataset-id-label">
          <mat-icon>description</mat-icon>
          <span>{{ 'recommendations.fileLabel' | translate }}</span>
        </div>
        <div class="dataset-name-value">{{ datasetName }}</div>
      </div>

      <div class="dataset-id-section">
        <div class="dataset-id-label">
          <mat-icon>fingerprint</mat-icon>
          <span>{{ 'recommendations.datasetIdLabel' | translate }}</span>
        </div>
        <div class="dataset-id-value">
          <code>{{ datasetId }}</code>
          <button
            mat-icon-button
            (click)="copyDatasetId()"
            [matTooltip]="'common.copyId' | translate">
            <mat-icon>content_copy</mat-icon>
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <app-error-panel [error]="error"></app-error-panel>

  <mat-card class="filters-card" *ngIf="!loading && recommendations.length > 0">
    <mat-card-content>
      <div class="filters-container">
        <div class="filter-group">
          <mat-icon>filter_list</mat-icon>
          <mat-form-field appearance="outline">
            <mat-label>{{ 'recommendations.filterChartType' | translate }}</mat-label>
            <mat-select [(ngModel)]="selectedChartType" (selectionChange)="onChartTypeChange()">
              <mat-option *ngFor="let type of chartTypes" [value]="type">
                {{ type === 'All' ? ('recommendations.allTypes' | translate) : type }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="filter-group">
          <mat-icon>sort</mat-icon>
          <mat-form-field appearance="outline">
            <mat-label>{{ 'recommendations.filterSortBy' | translate }}</mat-label>
            <mat-select [(ngModel)]="sortBy" (selectionChange)="onSortChange()">
              <mat-option value="score">{{ 'recommendations.filterSortScore' | translate }}</mat-option>
              <mat-option value="impact">{{ 'recommendations.filterSortImpact' | translate }}</mat-option>
              <mat-option value="type">{{ 'recommendations.filterSortType' | translate }}</mat-option>
              <mat-option value="title">{{ 'recommendations.filterSortTitle' | translate }}</mat-option>
              <mat-option value="default">{{ 'recommendations.filterSortDefault' | translate }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="results-count">
          <mat-icon>bar_chart</mat-icon>
          <span>{{ 'recommendations.resultsCount' | translate:{ count: filteredRecommendations.length } }}</span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="recommendations-grid" *ngIf="loading">
    <app-skeleton-card *ngFor="let i of [1,2,3,4,5,6]"></app-skeleton-card>
  </div>

  <div class="recommendations-grid" *ngIf="!loading && filteredRecommendations.length > 0">
    <mat-card
      *ngFor="let rec of filteredRecommendations"
      class="recommendation-card"
      (click)="viewChart(rec)">
      <mat-card-header>
        <div mat-card-avatar class="card-icon">
          <mat-icon [color]="getChartTypeColor(getChartType(rec))">
            {{ getChartTypeIcon(getChartType(rec)) }}
          </mat-icon>
        </div>
        <mat-card-title>{{ rec.title }}</mat-card-title>
        <mat-card-subtitle *ngIf="rec.reason">{{ rec.reason }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="chart-preview">
          <div
            echarts
            class="chart-preview-canvas"
            [options]="getPreviewOption(rec)">
          </div>
        </div>

        <div class="chart-type-badge">
          <mat-chip [color]="getChartTypeColor(getChartType(rec))" highlighted>
            {{ getChartType(rec) }}
          </mat-chip>
          <mat-chip highlighted>
            {{ 'recommendations.score' | translate:{ value: formatScore(rec.score) } }}
          </mat-chip>
          <mat-chip highlighted>
            {{ 'recommendations.impact' | translate:{ value: formatScore(rec.impactScore) } }}
          </mat-chip>
        </div>

        <div class="chart-details" *ngIf="rec.xColumn || rec.yColumn">
          <div class="detail-row" *ngIf="rec.xColumn">
            <mat-icon>arrow_forward</mat-icon>
            <span><strong>{{ 'recommendations.xAxis' | translate }}</strong> {{ rec.xColumn }}</span>
          </div>
          <div class="detail-row" *ngIf="rec.yColumn">
            <mat-icon>arrow_upward</mat-icon>
            <span><strong>{{ 'recommendations.yAxis' | translate }}</strong> {{ rec.yColumn }}</span>
          </div>
          <div class="detail-row" *ngIf="rec.aggregation">
            <mat-icon>functions</mat-icon>
            <span><strong>{{ 'recommendations.aggregation' | translate }}</strong> {{ rec.aggregation }}</span>
          </div>
          <div class="detail-row" *ngIf="rec.timeBin">
            <mat-icon>calendar_today</mat-icon>
            <span><strong>{{ 'recommendations.period' | translate }}</strong> {{ rec.timeBin }}</span>
          </div>
        </div>

        <div class="criteria" *ngIf="rec.scoreCriteria && rec.scoreCriteria.length > 0">
          <div class="criteria-title">{{ 'recommendations.scoreCriteria' | translate }}</div>
          <ul>
            <li *ngFor="let criterion of rec.scoreCriteria | slice:0:3">{{ criterion }}</li>
          </ul>
        </div>

        <p class="reasoning" *ngIf="rec.reason">
          <mat-icon>lightbulb</mat-icon>
          {{ rec.reason }}
        </p>
      </mat-card-content>

      <mat-card-actions>
        <button mat-raised-button color="primary" class="open-chart-btn">
          <mat-icon>visibility</mat-icon>
          {{ 'recommendations.openChart' | translate }}
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <div class="empty-state" *ngIf="!loading && !error && recommendations.length === 0">
    <mat-icon>search_off</mat-icon>
    <h3>{{ 'recommendations.emptyTitle' | translate }}</h3>
    <p>{{ 'recommendations.emptySubtitle' | translate }}</p>
    <button mat-raised-button color="primary" [routerLink]="newDatasetLink">
      <mat-icon>upload_file</mat-icon>
      {{ 'recommendations.uploadNewDataset' | translate }}
    </button>
  </div>
</div>


