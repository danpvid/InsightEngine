<div class="container">
  <!-- Breadcrumb -->
  <nav class="breadcrumb">
    <a routerLink="/" class="breadcrumb-item">
      <mat-icon>home</mat-icon>
      <span>Datasets</span>
    </a>
    <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
    <span class="breadcrumb-item active">
      <mat-icon>auto_awesome</mat-icon>
      <span>Recomendações</span>
    </span>
  </nav>

  <app-page-header
    title="Recomendações de Gráficos"
    [subtitle]="'Dataset: ' + datasetId"
    icon="auto_awesome">
  </app-page-header>

  <mat-card class="dataset-info-card">
    <mat-card-content>
      <div class="dataset-id-section">
        <div class="dataset-id-label">
          <mat-icon>fingerprint</mat-icon>
          <span>ID do Dataset:</span>
        </div>
        <div class="dataset-id-value">
          <code>{{ datasetId }}</code>
          <button
            mat-icon-button
            (click)="copyDatasetId()"
            matTooltip="Copiar ID">
            <mat-icon>content_copy</mat-icon>
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <app-error-panel [error]="error"></app-error-panel>

  <!-- Filters -->
  <mat-card class="filters-card" *ngIf="!loading && recommendations.length > 0">
    <mat-card-content>
      <div class="filters-container">
        <div class="filter-group">
          <mat-icon>filter_list</mat-icon>
          <mat-form-field appearance="outline">
            <mat-label>Tipo de Gráfico</mat-label>
            <mat-select [(ngModel)]="selectedChartType" (selectionChange)="onChartTypeChange()">
              <mat-option *ngFor="let type of chartTypes" [value]="type">
                {{ type === 'All' ? 'Todos' : type }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="filter-group">
          <mat-icon>sort</mat-icon>
          <mat-form-field appearance="outline">
            <mat-label>Ordenar por</mat-label>
            <mat-select [(ngModel)]="sortBy" (selectionChange)="onSortChange()">
              <mat-option value="default">Padrão</mat-option>
              <mat-option value="type">Tipo</mat-option>
              <mat-option value="title">Título</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="results-count">
          <mat-icon>bar_chart</mat-icon>
          <span>{{ filteredRecommendations.length }} recomendações</span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Skeleton Loading -->
  <div class="recommendations-grid" *ngIf="loading">
    <app-skeleton-card *ngFor="let i of [1,2,3,4,5,6]"></app-skeleton-card>
  </div>

  <!-- Recommendations Grid -->
  <div class="recommendations-grid" *ngIf="!loading && filteredRecommendations.length > 0">
    <mat-card
      *ngFor="let rec of filteredRecommendations"
      class="recommendation-card"
      (click)="viewChart(rec)">
      <mat-card-header>
        <div mat-card-avatar class="card-icon">
          <mat-icon [color]="getChartTypeColor(getChartType(rec))">
            {{ getChartTypeIcon(getChartType(rec)) }}
          </mat-icon>
        </div>
        <mat-card-title>{{ rec.title }}</mat-card-title>
        <mat-card-subtitle *ngIf="rec.reason">{{ rec.reason }}</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="chart-type-badge">
          <mat-chip [color]="getChartTypeColor(getChartType(rec))" highlighted>
            {{ getChartType(rec) }}
          </mat-chip>
        </div>

        <div class="chart-details" *ngIf="rec.xColumn || rec.yColumn">
          <div class="detail-row" *ngIf="rec.xColumn">
            <mat-icon>arrow_forward</mat-icon>
            <span><strong>Eixo X:</strong> {{ rec.xColumn }}</span>
          </div>
          <div class="detail-row" *ngIf="rec.yColumn">
            <mat-icon>arrow_upward</mat-icon>
            <span><strong>Eixo Y:</strong> {{ rec.yColumn }}</span>
          </div>
          <div class="detail-row" *ngIf="rec.aggregation">
            <mat-icon>functions</mat-icon>
            <span><strong>Agregação:</strong> {{ rec.aggregation }}</span>
          </div>
          <div class="detail-row" *ngIf="rec.timeBin">
            <mat-icon>calendar_today</mat-icon>
            <span><strong>Período:</strong> {{ rec.timeBin }}</span>
          </div>
        </div>

        <p class="reasoning" *ngIf="rec.reason">
          <mat-icon>lightbulb</mat-icon>
          {{ rec.reason }}
        </p>
      </mat-card-content>

      <mat-card-actions>
        <button mat-raised-button color="primary" class="open-chart-btn">
          <mat-icon>visibility</mat-icon>
          Abrir Gráfico
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <div class="empty-state" *ngIf="!loading && !error && recommendations.length === 0">
    <mat-icon>search_off</mat-icon>
    <h3>Nenhuma recomendação disponível</h3>
    <p>Não foi possível gerar recomendações de gráficos para este dataset.</p>
    <button mat-raised-button color="primary" routerLink="/datasets/new">
      <mat-icon>upload_file</mat-icon>
      Enviar Novo Dataset
    </button>
  </div>
</div>
